================================================================================
            TUTORIAL DE INSTALA√á√ÉO - ANDROID STREAM MANAGER
================================================================================

Este tutorial guia a instala√ß√£o completa do Android Stream Manager no WSL Ubuntu.

üéØ OBJETIVO: Sistema de gerenciamento remoto de dispositivos Android funcional

================================================================================
PASSO 1: PREPARA√á√ÉO DO AMBIENTE WSL UBUNTU
================================================================================

1.1 Verificar vers√£o do Ubuntu no WSL:
    lsb_release -a
    # Deve ser Ubuntu 20.04 ou superior

1.2 Atualizar o sistema:
    sudo apt update && sudo apt upgrade -y

1.3 Instalar ferramentas b√°sicas:
    sudo apt install -y \
        git \
        curl \
        wget \
        build-essential \
        cmake \
        ninja-build \
        pkg-config \
        software-properties-common \
        apt-transport-https \
        ca-certificates \
        gnupg \
        lsb-release \
        libsqlite3-dev

================================================================================
PASSO 2: INSTALA√á√ÉO DAS DEPEND√äNCIAS DO SISTEMA
================================================================================

2.1 Bibliotecas essenciais:
    sudo apt install -y \
        libssl-dev \
        zlib1g-dev \
        liblz4-dev \
        libzip-dev \
        libjwt-dev \
        uuid-dev

2.2 Qt6 para o Dashboard (interface gr√°fica):
    sudo apt install -y \
        qt6-base-dev \
        qt6-tools-dev \
        qt6-multimedia-dev \
        qt6-declarative-dev

2.3 Ferramentas de desenvolvimento:
    sudo apt install -y \
        clang \
        clang-format \
        clang-tidy \
        valgrind \
        gdb \
        doxygen \
        graphviz

2.4 Verificar se as depend√™ncias foram instaladas:
    pkg-config --list-all | grep -E "(ssl|zlib|lz4|zip|jwt|qt6)"

================================================================================
PASSO 3: CLONAR E PREPARAR O PROJETO
================================================================================

3.1 Clonar o reposit√≥rio:
git clone https://github.com/aprincipalbb30-source/android-stream-manager.git

    cd android-stream-manager

3.2 Verificar estrutura do projeto:
    ls -la
    # Deve conter: core/, security/, optimization/, android-client-template/, etc.

3.3 Dar permiss√µes de execu√ß√£o aos scripts:
    chmod +x scripts/*.sh
    chmod +x tutorial-install-linux.sh

================================================================================
PASSO 4: BUILD B√ÅSICO (TESTE R√ÅPIDO)
================================================================================

4.1 Build da biblioteca core (teste r√°pido):
    make build

    # Sa√≠da esperada:
    # Compilando core/system_manager.cpp...
    # Compilando core/apk_builder.cpp...
    # Compilando optimization/stream_optimizer.cpp...
    # Criando biblioteca core...
    # ar: creating lib/libcore.a

4.2 Verificar se o build foi bem-sucedido:
    ls -la lib/
    # Deve conter: libcore.a

4.3 Executar teste b√°sico:
    make test

    # Sa√≠da esperada:
    # === Testes do Android Stream Manager ===
    # === Teste ThreadPool ===
    # === Teste StreamOptimizer ===
    # === Teste BuildCache ===
    # === Todos os testes conclu√≠dos ===

================================================================================
PASSO 5: BUILD COMPLETO COM CMAKE
================================================================================

5.1 Criar diret√≥rio de build:
    mkdir -p build
    cd build

5.2 Configurar com CMake:
    cmake .. \
        -DCMAKE_BUILD_TYPE=Release \
        -DBUILD_DASHBOARD=ON \
        -DBUILD_APK_BUILDER=ON \
        -DBUILD_TESTS=OFF

5.3 Compilar:
    make -j$(nproc)

5.4 Verificar execut√°veis gerados:
    ls -la bin/
    # Deve conter:
    # android_stream_dashboard (se Qt6 instalado)
    # apk_builder
    # stream_server

5.5 Executar dashboard Qt:
    cd bin
    ./android_stream_dashboard

    # Interface gr√°fica ser√° aberta com:
    # - Lista de dispositivos conectados
    # - Configura√ß√£o de APK
    # - Hist√≥rico de builds
    # - Logs do sistema
    # - Controles de streaming (servidor principal)

================================================================================
PASSO 6: CONFIGURA√á√ÉO DO ANDROID SDK (OPCIONAL - PARA BUILD DE APKS)
================================================================================

6.1 Criar diret√≥rio do Android SDK:
    mkdir -p ~/android-sdk
    cd ~/android-sdk

6.2 Baixar Command Line Tools:
    wget https://dl.google.com/android/repository/commandlinetools-linux-9477386_latest.zip

6.3 Extrair e configurar:
    unzip commandlinetools-linux-9477386_latest.zip
    mkdir -p cmdline-tools
    mv cmdline-tools/* cmdline-tools/
    rm commandlinetools-linux-9477386_latest.zip

6.4 Configurar vari√°veis de ambiente:
    echo 'export ANDROID_SDK_ROOT="$HOME/android-sdk"' >> ~/.bashrc
    echo 'export ANDROID_HOME="$ANDROID_SDK_ROOT"' >> ~/.bashrc
    echo 'export PATH="$PATH:$ANDROID_SDK_ROOT/cmdline-tools/bin:$ANDROID_SDK_ROOT/platform-tools"' >> ~/.bashrc
    source ~/.bashrc

6.5 Instalar componentes do Android:
    cd ~/android-sdk
    sdkmanager --install "platform-tools"
    sdkmanager --install "platforms;android-33"
    sdkmanager --install "build-tools;33.0.0"
    sdkmanager --install "ndk;25.2.9519653"
    sdkmanager --install "cmake;3.22.1"

6.6 Verificar instala√ß√£o:
    adb version
    # Deve mostrar vers√£o do ADB

================================================================================
PASSO 7: CONFIGURA√á√ÉO DO SISTEMA
================================================================================

7.1 Copiar arquivos de configura√ß√£o:
    sudo mkdir -p /etc/android-stream-manager
    sudo cp config/system_config.json /etc/android-stream-manager/

7.2 Criar diret√≥rios necess√°rios:
    sudo mkdir -p \
        /var/lib/android-stream-manager/{apks,cache,sessions} \
        /var/log/android-stream-manager \
        /usr/local/share/android-stream-manager/templates

7.3 Copiar templates (se existirem):
    sudo cp -r templates/* /usr/local/share/android-stream-manager/templates/ 2>/dev/null || true

================================================================================
PASSO 8: INSTALA√á√ÉO DO SISTEMA (OPCIONAL)
================================================================================

8.1 Instalar biblioteca core:
    sudo make install

8.2 Verificar instala√ß√£o:
    ls -la /usr/local/lib/libcore.a
    ls -la /usr/local/include/android-stream-manager/

================================================================================
PASSO 9: BUILD DO APK ANDROID
================================================================================

9.1 Entrar no diret√≥rio do template:
    cd android-client-template

9.2 Verificar se tem Android SDK configurado:
    echo $ANDROID_SDK_ROOT
    # Deve apontar para ~/android-sdk

9.3 Build do APK (modo debug):
    ./gradlew assembleDebug

9.4 Verificar APK gerado:
    ls -la app/build/outputs/apk/debug/
    # Deve conter: app-debug.apk

================================================================================
PASSO 10: TESTE INTEGRADO DO SISTEMA
================================================================================

10.1 Executar dashboard (se Qt6 instalado):
     cd build/bin
     ./android_stream_dashboard

10.2 Testar APK builder:
     cd build/bin
     ./apk_builder --help

10.3 Executar servidor principal:
     cd build/bin
     ./stream_server --help

     # Executar servidor:
     ./stream_server --port 8443

10.4 Testar persist√™ncia de dados:
     # O servidor cria automaticamente stream_manager.db
     ls -la /etc/android-stream-manager/
     # Deve conter: stream_manager.db

     # Verificar tamanho do banco:
     du -h /etc/android-stream-manager/stream_manager.db

10.5 Verificar conectividade de rede:
     # Testar API do servidor
     curl -X GET http://localhost:8443/api/health

     # Ver estat√≠sticas
     curl -X GET http://localhost:8443/api/stats

     # Listar dispositivos conectados
     curl -X GET http://localhost:8443/api/devices

================================================================================
PASSO 11: INSTALA√á√ÉO DO APK NO DISPOSITIVO ANDROID
================================================================================

11.1 Conectar dispositivo Android via USB:
     adb devices
     # Deve mostrar dispositivo conectado

11.2 Instalar APK:
     adb install -r android-client-template/app/build/outputs/apk/debug/app-debug.apk

11.3 Conceder permiss√µes (no dispositivo):
     # Abra o app e conceda todas as permiss√µes solicitadas

================================================================================
PROBLEMAS COMUNS E SOLU√á√ïES
================================================================================

PROBLEMA 1: "lz4 library not found"
SOLU√á√ÉO:
    sudo apt install liblz4-dev

PROBLEMA 2: "Qt6 not found"
SOLU√á√ÉO:
    sudo apt install qt6-base-dev qt6-tools-dev qt6-multimedia-dev

PROBLEMA 3: "Android SDK not found"
SOLU√á√ÉO:
    Verificar se ANDROID_SDK_ROOT est√° configurado
    source ~/.bashrc

PROBLEMA 4: "Build falha com erros de SSL"
SOLU√á√ÉO:
    sudo apt install libssl-dev
    Verificar vers√£o: pkg-config --modversion libssl

PROBLEMA 5: "CMake n√£o encontra bibliotecas"
SOLU√á√ÉO:
    pkg-config --libs --cflags libssl lz4 libzip
    # Deve mostrar flags de compila√ß√£o

PROBLEMA 6: "Qt6 interface n√£o abre no WSL"
SOLU√á√ÉO:
    export DISPLAY=:0
    # Ou usar X11 forwarding se configurar X server no Windows

================================================================================
VERIFICA√á√ÉO FINAL DO SISTEMA
================================================================================

Script de verifica√ß√£o completa:
    #!/bin/bash
    echo "=== Verifica√ß√£o do Android Stream Manager ==="

    # Verificar depend√™ncias
    echo "Depend√™ncias:"
    pkg-config --exists libssl && echo "‚úì OpenSSL" || echo "‚úó OpenSSL"
    pkg-config --exists liblz4 && echo "‚úì LZ4" || echo "‚úó LZ4"
    pkg-config --exists libzip && echo "‚úì libzip" || echo "‚úó libzip"
    pkg-config --exists Qt6Core && echo "‚úì Qt6" || echo "‚úó Qt6"

    # Verificar build
    echo -e "\nBuild:"
    [ -f "lib/libcore.a" ] && echo "‚úì Biblioteca core" || echo "‚úó Biblioteca core"
    [ -f "build/bin/android_stream_dashboard" ] && echo "‚úì Dashboard" || echo "‚úó Dashboard"
    [ -f "android-client-template/app/build/outputs/apk/debug/app-debug.apk" ] && echo "‚úì APK Android" || echo "‚úó APK Android"

    # Verificar Android SDK
    echo -e "\nAndroid SDK:"
    [ -n "$ANDROID_SDK_ROOT" ] && echo "‚úì ANDROID_SDK_ROOT configurado" || echo "‚úó ANDROID_SDK_ROOT n√£o configurado"
    [ -d "$ANDROID_SDK_ROOT/platform-tools" ] && echo "‚úì Platform tools instalado" || echo "‚úó Platform tools faltando"

    echo -e "\n=== Verifica√ß√£o conclu√≠da ==="

================================================================================
COMANDOS √öTEIS PARA DESENVOLVIMENTO
================================================================================

# Build r√°pido
make build && make test

# Build completo
cd build && make -j$(nproc)

# Limpar tudo
make clean

# Formatar c√≥digo
make format

# An√°lise est√°tica
make lint

# Status do projeto
make status

# Contar linhas de c√≥digo
make count

================================================================================
ESTRUTURA FINAL ESPERADA
================================================================================

android-stream-manager/
‚îú‚îÄ‚îÄ bin/
‚îÇ   ‚îú‚îÄ‚îÄ android_stream_dashboard    # Interface Qt
‚îÇ   ‚îî‚îÄ‚îÄ apk_builder                # Construtor de APKs
‚îú‚îÄ‚îÄ lib/
‚îÇ   ‚îî‚îÄ‚îÄ libcore.a                  # Biblioteca core
‚îú‚îÄ‚îÄ android-client-template/
‚îÇ   ‚îî‚îÄ‚îÄ app/build/outputs/apk/debug/app-debug.apk
‚îú‚îÄ‚îÄ config/
‚îÇ   ‚îî‚îÄ‚îÄ system_config.json
‚îú‚îÄ‚îÄ /etc/android-stream-manager/
‚îÇ   ‚îî‚îÄ‚îÄ system_config.json
‚îî‚îÄ‚îÄ /usr/local/include/android-stream-manager/
    ‚îî‚îÄ‚îÄ *.h                        # Headers C++

================================================================================
PR√ìXIMOS PASSOS AP√ìS INSTALA√á√ÉO
================================================================================

1. Configurar servidor de produ√ß√£o
2. Implementar autentica√ß√£o JWT
3. Configurar TLS/SSL
4. Implementar dashboard web (opcional)
5. Adicionar monitoramento
6. Configurar backup autom√°tico
7. Documentar APIs

================================================================================
SUPORTE E DOCUMENTA√á√ÉO
================================================================================

- Documenta√ß√£o: docs/ (quando implementada)
- Logs: /var/log/android-stream-manager/
- Configura√ß√µes: /etc/android-stream-manager/
- C√≥digo fonte: src/, android-client-template/

================================================================================
PASSO 8: SISTEMA DE MONITORAMENTO E M√âTRICAS
================================================================================

8.1 Vis√£o Geral do Sistema de Monitoramento:
O Android Stream Manager inclui um sistema completo de monitoramento com:

üìä M√âTRICAS COLETADAS:
- CPU, Mem√≥ria, Disco, Rede do sistema
- Status e bateria dos dispositivos
- Streams ativos, lat√™ncia, bitrate
- Taxa de erro, conex√µes ativas
- Cache hits/misses, queries do banco

üö® SISTEMA DE ALERTAS:
- Alertas autom√°ticos por email/Telegram
- Severidades: LOW, MEDIUM, HIGH, CRITICAL
- Cooldown configur√°vel entre alertas
- Reconhecimento e resolu√ß√£o de alertas

üîç VERIFICA√á√ÉO DE SA√öDE:
- Health checks autom√°ticos
- Status: HEALTHY, DEGRADED, UNHEALTHY
- Verifica√ß√µes: sistema, banco, rede, dispositivos
- Dashboard em tempo real

üìà EXPORTA√á√ÉO PROMETHEUS:
- Endpoint HTTP /metrics no formato Prometheus
- Compat√≠vel com Grafana, AlertManager
- M√©tricas customiz√°veis

8.2 Usando o Dashboard de Monitoramento:

No Dashboard Qt (interface gr√°fica):
- Menu Monitoramento ‚Üí Dashboard de Monitoramento
- Ctrl+M para abrir rapidamente
- F12 para atualizar m√©tricas

Funcionalidades dispon√≠veis:
- M√©tricas em tempo real (CPU, mem√≥ria, disco)
- Gr√°fico hist√≥rico de CPU (√∫ltimos 2 minutos)
- Lista de dispositivos conectados
- Status de streaming ativo
- Tabela de alertas ativos
- Status de sa√∫de do sistema
- Logs em tempo real

8.3 Mini-Emulador de Streaming (estilo MemuPlay):

Interface visual similar ao MemuPlay com controles laterais:
- Menu Streaming ‚Üí Visualizador de Streaming
- Ctrl+S para abrir rapidamente
- Selecione um dispositivo antes de abrir

Controles virtuais dispon√≠veis:
- üîÑ Voltar, üè† Home, ‚ò∞ Menu (linha superior)
- üîâ Volume-, ‚èª Power, üîä Volume+ (linha central)
- üîÑ Rotacionar, üì∏ Screenshot, ‚öôÔ∏è Config (linha inferior)

Funcionalidades do emulador:
- Toque na tela com feedback visual
- Eventos de teclado mapeados
- Rota√ß√£o Portrait/Landscape
- Moldura realista de dispositivo Android
- Status de conex√£o em tempo real
- Qualidade de streaming ajust√°vel

8.4 Bloqueio de Tela Remoto (Controle Corporativo):

Funcionalidade de seguran√ßa avan√ßada para controle remoto total:
- Menu Streaming ‚Üí Bloquear Tela Remota (Ctrl+Shift+L)
- Menu Streaming ‚Üí Desbloquear Tela Remota (Ctrl+Shift+U)

Como funciona o bloqueio:
- Dispositivo mostra tela de "Atualizando o sistema Android"
- Barra de progresso simulada (30 segundos)
- Mensagem "N√£o toque na tela durante a atualiza√ß√£o"
- Indicador "Controle Remoto Ativo" no canto inferior
- Usu√°rio local N√ÉO consegue interagir com o dispositivo

Controles de emerg√™ncia (desenvolvimento):
- Toque 10x na tela para ativar modo emerg√™ncia
- Toque longo no logo do Android para emerg√™ncia
- Bot√£o f√≠sico Volume + Power simult√¢neo

Vantagens do bloqueio remoto:
- ‚úÖ Usu√°rio local impedido de interferir
- ‚úÖ Servidor mant√©m controle total remoto
- ‚úÖ Streaming continua funcionando normalmente
- ‚úÖ Apar√™ncia profissional de atualiza√ß√£o
- ‚úÖ Controle remoto mantido ativo

Cen√°rios de uso:
- Dispositivos em ambientes p√∫blicos
- Controle remoto sem interfer√™ncia local
- Manuten√ß√£o remota segura
- Acesso corporativo controlado

8.3 Endpoint Prometheus:

O servidor exp√µe m√©tricas no formato Prometheus:
- URL: http://localhost:9090/metrics
- Compat√≠vel com scraping autom√°tico
- M√©tricas incluem labels para dispositivos

Exemplo de uso com Prometheus:
```yaml
scrape_configs:
  - job_name: 'android_stream_manager'
    static_configs:
      - targets: ['localhost:9090']
```

8.4 Configura√ß√£o de Alertas:

Alertas padr√£o configurados:
- CPU > 90% (HIGH)
- Mem√≥ria > 85% (HIGH)
- Disco > 90% usado (MEDIUM)
- Dispositivo desconectado (HIGH)
- Bateria < 20% (MEDIUM)
- Lat√™ncia > 100ms (MEDIUM)
- Taxa erro > 5% (HIGH)

Para modificar alertas, editar o c√≥digo em:
- monitoring/alerts_manager.cpp
- M√©todo: setupDefaultAlertRules()

8.5 Monitoramento Avan√ßado:

Para integra√ß√£o com sistemas externos:
- Webhooks para alertas
- API REST para m√©tricas
- Logs estruturados
- M√©tricas customizadas via API

================================================================================
PASSO 9: VERIFICA√á√ÉO FINAL E SUPORTE
================================================================================

Para suporte adicional, consulte:
- README.md (quando criado)
- Issues do GitHub
- Documenta√ß√£o t√©cnica nos arquivos .h
- Dashboard de Monitoramento (Monitoramento ‚Üí Dashboard)

================================================================================
FIM DO TUTORIAL - SISTEMA PRONTO PARA USO!
================================================================================